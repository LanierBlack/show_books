$(document).ready(function(){function a(){s.removeClass("hide")}function n(){s.addClass("hide")}function o(){var a=window.location.pathname.split("/")[2];a&&$.ajax({type:"GET",url:"https://api.douban.com/v2/book/search?q="+a,dataType:"jsonp",jsonp:"callback",success:function(a){t(a)}})}function t(o){var t=0,s=200,e=$("#books>div"),i=Math.min(e.length,o.books.length);if(o.books.length<e.length){var c=$("#books>div:eq(0)");c.css("width","100%"),e=[c]}$.each(o.books,function(o,c){var d=$("<section></section>"),r=$("<header></header>"),p=$('<p class="bookTitle">'+c.title+"</a>"),l=$('<span class="bookAuthor">作者: '+(c.author[0]||"无")+"</span>");$image=$('<img src="'+c.image+'" />'),$p=$("<p>"+c.summary.replace(/\n/g,"<br />")+"</p>"),$tags=$('<div class="bookTags"></div>'),$doubanBtn=$('<a class="bookBtn" href="'+c.alt+'" target="_blank><button type="button" class="doubanBtn">豆瓣</button></a>'),$addBtn=$('<a href="#" class="addBtn">收藏</a>'),$.each(c.tags,function(a,n){$tags.append('<span class="bookTag">'+n.name+"</span>")}),$addBtn.click(function(){a(),$.post("/book",{bookId:c.id,isbn10:c.isbn10||"",isbn13:c.isbn13||"",name:c.title,author:c.author[0]||"",img:c.image||"",summary:c.summary||""},function(a){n(),a.success&&window.location.replace("/archive")})}),r.append($image,p,l,$doubanBtn,$addBtn),d.append(r,$tags,$p);for(var u=$(e[0]),b=parseInt(u.css("height"),10),h=1;h<i;++h){var g=parseInt($(e[h]).css("height"),10);g<b&&(u=$(e[h]),b=g)}u.append(d).hide().delay(t).fadeIn(500),t+=s})}var s=$("#dialog");n(),$("form").submit(a),$("a").click(a),n(),o()});